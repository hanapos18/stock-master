{% extends "base.html" %}
{% block title %}Order {{ order.order_number }}{% endblock %}
{% block page_title %}Wholesale Order {{ order.order_number }}{% endblock %}
{% block content %}
<div class="card border-0 shadow-sm">
  <div class="card-body">
    <div class="row mb-3">
      <div class="col-md-3"><strong>Client:</strong> {{ order.client_name }}</div>
      <div class="col-md-3"><strong>Date:</strong> {{ order.order_date }}</div>
      <div class="col-md-3"><strong>Delivery:</strong> {{ order.delivery_date or 'TBD' }}</div>
      <div class="col-md-3"><strong>Status:</strong> <span class="badge bg-{{ 'success' if order.status=='delivered' else 'info' if order.status=='shipped' else 'warning' }}">{{ order.status }}</span></div>
    </div>
    <table class="table table-sm"><thead class="table-light"><tr><th>Code</th><th>Product</th><th>Qty</th><th>Unit</th><th>Price</th><th>Disc%</th><th>Disc Amt</th><th>Amount</th></tr></thead><tbody>
      {% for i in order.line_items %}<tr>
        <td><code>{{ i.product_code }}</code></td><td>{{ i.product_name }}</td><td>{{ i.quantity }}</td><td>{{ i.unit }}</td>
        <td class="text-end">{{ i.unit_price|fmt_price }}</td><td>{{ i.discount_rate }}%</td>
        <td class="text-end text-danger">-{{ i.discount_amount|fmt_price }}</td><td class="text-end">{{ i.amount|fmt_price }}</td>
      </tr>{% endfor %}
      <tr class="fw-bold"><td colspan="7" class="text-end">Subtotal:</td><td class="text-end">{{ order.total_amount|fmt_price }}</td></tr>
      <tr class="text-danger"><td colspan="7" class="text-end">Discount:</td><td class="text-end">-{{ order.discount_amount|fmt_price }}</td></tr>
      <tr class="fw-bold fs-5"><td colspan="7" class="text-end">Final:</td><td class="text-end">{{ order.final_amount|fmt_price }}</td></tr>
    </tbody></table>
    <div class="mt-3">
      {% if order.status in ('draft','confirmed') %}
      <form method="post" action="{{ url_for('wholesale.ship_order', order_id=order.id) }}" class="d-inline">
        <button class="btn btn-success" onclick="return confirm('Ship and deduct inventory?')"><i class="bi bi-truck me-1"></i>Ship (Deduct Inventory)</button>
      </form>{% endif %}
      <a href="{{ url_for('wholesale.print_delivery_list', order_id=order.id) }}" class="btn btn-outline-primary" target="_blank"><i class="bi bi-printer me-1"></i>Print Delivery List</a>
      <a href="{{ url_for('wholesale.list_orders') }}" class="btn btn-outline-secondary ms-2">Back</a>
    </div>
  </div>
</div>
{% endblock %}
