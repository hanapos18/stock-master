{% extends "base.html" %}
{% block title %}New Wholesale Order{% endblock %}
{% block page_title %}New Wholesale Order{% endblock %}
{% block content %}
<div class="card border-0 shadow-sm">
  <div class="card-body">
    <form method="post">
      <div class="row g-3 mb-4">
        <div class="col-md-4"><label class="form-label">Client *</label>
          <select name="client_id" class="form-select" required><option value="">-- Select --</option>
            {% for c in clients %}<option value="{{ c.id }}">{{ c.name }} ({{ c.default_discount_rate }}%)</option>{% endfor %}</select></div>
        <div class="col-md-3"><label class="form-label">Order Date *</label><input type="date" name="order_date" class="form-control" required></div>
        <div class="col-md-3"><label class="form-label">Delivery Date</label><input type="date" name="delivery_date" class="form-control"></div>
        <div class="col-md-2"><label class="form-label">Memo</label><input type="text" name="memo" class="form-control"></div>
      </div>
      <h6>Items</h6>
      <div class="mb-3 position-relative" style="max-width:400px;">
        <input type="text" id="productSearch" class="form-control form-control-sm" placeholder="Search product..." autocomplete="off">
        <div id="searchResults" class="product-search-results" style="display:none;"></div>
      </div>
      <table class="table table-sm"><thead><tr><th>Product</th><th style="width:120px">Qty</th><th style="width:140px">Unit Price</th><th style="width:100px">Amount</th><th style="width:50px"></th></tr></thead>
        <tbody id="itemsBody"></tbody>
        <tfoot><tr><td colspan="3" class="text-end fw-bold">Total:</td><td class="fw-bold" id="grandTotal">0.00</td><td></td></tr></tfoot>
      </table>
      <button type="submit" class="btn btn-primary">Create Order</button>
      <a href="{{ url_for('wholesale.list_orders') }}" class="btn btn-outline-secondary ms-2">Cancel</a>
    </form>
  </div>
</div>
{% endblock %}
{% block scripts %}
<script>initProductSearch('productSearch', 'searchResults', function(p) { addItemRow('itemsBody', p, 'sell'); });</script>
{% endblock %}
